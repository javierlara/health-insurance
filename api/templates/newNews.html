{% extends "layout.html" %}
{% block body %}
  {% if session.logged_in %}
    <div class="container">
        {% if news %}
            <h1>Editar noticia</h1>
        {% else %}
            <h1>Noticia</h1>
        {% endif %}
      <form id='newsForm' role="form" method='POST' action="{{ '/api/news' + ('/' + news.id|string if news else '') }}" enctype='application/json'>
        <div class="form-group">
            <input type="text" name="title" class="form-control" id="address-box" placeholder="TÃ­tulo" style="max-width: 300px;" autofocus required value="{{ news.title if news else '' }}" />
            <input type="text" name="image" class="form-control" id="address-box" placeholder="Imagen" style="max-width: 300px;" autofocus required value="{{ news.image if news else '' }}" />
            <input type="text" name="content" class="form-control" id="address-box" placeholder="Contenido" style="max-width: 300px;" autofocus required value="{{ news.content if news else '' }}" />
            <input type="text" name="author_id" class="form-control" id="address-box" placeholder="Autor" style="max-width: 300px;" autofocus required value="{{ news.author_id if news else '' }}" />
        </div>
        <button type="submit" class="btn btn-default">Submit</button>
      </form>
      <br>
      {% for error in errors %}
        <h4>{{ error }}</h4>
      {% endfor %}
    </div>
    <script type='text/javascript'>
        $("#newsForm").submit(function(event) {
            event.preventDefault();
            var $form = $( this ), url = $form.attr( 'action' );
            var formData = JSON.stringify($form.serializeObject())
            $.ajax({
                {% if news %}
                type: "PUT",
                {% else %}
                type: "POST",
                {% endif %}
                url: url,
                data: formData,
                success: function() {
                    window.location.replace("{{ url_for('newses') }}")
                },
                dataType: "json",
                contentType : "application/json"
            });
        });

        $.fn.serializeObject = function()
        {
            var o = {};
            var a = this.serializeArray();
            $.each(a, function() {
                if (o[this.name] !== undefined) {
                    if (!o[this.name].push) {
                        o[this.name] = [o[this.name]];
                    }
                    o[this.name].push(this.value || '');
                } else {
                    o[this.name] = this.value || '';
                }
            });
            return o;
        };
    </script>
  {% endif %}
{% endblock %}